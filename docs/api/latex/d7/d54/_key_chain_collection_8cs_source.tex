\doxysection{Key\+Chain\+Collection.\+cs}
\hypertarget{_key_chain_collection_8cs_source}{}\label{_key_chain_collection_8cs_source}\index{KeyChainCollection.cs@{KeyChainCollection.cs}}
\mbox{\hyperlink{_key_chain_collection_8cs}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00001}00001\ \textcolor{keyword}{namespace\ }\mbox{\hyperlink{namespace_s_a_p_team_1_1_kryptor_1_1_client}{SAPTeam.Kryptor.Client}}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00002}00002\ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00006}\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection}{00006}}\ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keyword}{class\ }\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection}{KeyChainCollection}}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00007}00007\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00008}00008\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}\ readonly\ \textcolor{keywordtype}{object}\ \_saveLock\ =\ \textcolor{keyword}{new}\ object();}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00010}00010\ \ \ \ \ \ \ \ \ \textcolor{keyword}{private}\ readonly\ List<KeyChain>\ keyChainList;}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00011}00011\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00015}\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_a73b0251bf7f720e7a5ebce006bd54193}{00015}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{string}\ \mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_a73b0251bf7f720e7a5ebce006bd54193}{FilePath}}\ \{\ \textcolor{keyword}{get};\ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00016}00016\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00026}\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_a3963a969846928ec0da23e7bf7596cb0}{00026}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain}{KeyChain}}\ \textcolor{keyword}{this}[\textcolor{keywordtype}{string}\ serial]}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00027}00027\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00028}00028\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{get}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00029}00029\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00030}00030\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ IEnumerable<KeyChain>\ entries\ =\ keyChainList.Where(x\ =>\ x.Serial\ ==\ serial);}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00031}00031\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (!entries.Any())}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00032}00032\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00033}00033\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ KeyNotFoundException(serial);}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00034}00034\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00035}00035\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (entries.Count()\ >\ 1)}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00036}00036\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00037}00037\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ ApplicationException(\textcolor{stringliteral}{"{}Illegal\ douplication\ found\ in\ keychain"{}});}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00038}00038\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00039}00039\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00040}00040\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return}\ entries.First();}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00041}00041\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00042}00042\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00043}00043\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00050}\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_abbc1bfeeb7bdb00fcacfd44a5618d8f8}{00050}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_abbc1bfeeb7bdb00fcacfd44a5618d8f8}{KeyChainCollection}}(\textcolor{keywordtype}{string}\ path)}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00051}00051\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00052}00052\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (File.Exists(path))}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00053}00053\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00054}00054\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_a73b0251bf7f720e7a5ebce006bd54193}{FilePath}}\ =\ path;}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00055}00055\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00056}00056\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{else}\ \textcolor{keywordflow}{if}\ (!Directory.Exists(path))}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00057}00057\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00058}00058\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Directory.CreateDirectory(path);}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00059}00059\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00060}00060\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (Directory.Exists(path))}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_a73b0251bf7f720e7a5ebce006bd54193}{FilePath}}\ =\ Path.Combine(path,\ \textcolor{stringliteral}{"{}keychain.json"{}});}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00064}00064\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00065}00065\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ data\ =\ \textcolor{keyword}{null};}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00067}00067\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keyword}{using}\ (StreamReader\ reader\ =\ \textcolor{keyword}{new}\ StreamReader(File.Open(\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_a73b0251bf7f720e7a5ebce006bd54193}{FilePath}},\ FileMode.OpenOrCreate)))}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00068}00068\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00069}00069\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\ =\ reader.ReadToEnd();}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00070}00070\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{string}.IsNullOrEmpty(data))}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00071}00071\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00072}00072\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ data\ =\ \textcolor{stringliteral}{"{}[]"{}};}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00073}00073\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00074}00074\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00075}00075\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ keyChainList\ =\ Utilities.ClientTypesJsonWorker.ReadJson<List<KeyChain>>(data);}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00077}00077\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00078}00078\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00092}\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_a362440dd4927a2ccc074ed7ea5653df8}{00092}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_a362440dd4927a2ccc074ed7ea5653df8}{Add}}(\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_client_header}{ClientHeader}}\ header,\ \mbox{\hyperlink{struct_s_a_p_team_1_1_kryptor_1_1_key_store}{KeyStore}}\ keyStore,\ \textcolor{keywordtype}{string}\ transformerToken\ =\ \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00093}00093\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00094}00094\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{string}.IsNullOrEmpty(header.\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_client_header_a19fd25dd10cc17b78cabec405636ff4e}{Serial}}))}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00095}00095\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00096}00096\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ ArgumentException(\textcolor{stringliteral}{"{}Invalid\ header\ serial"{}});}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00097}00097\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00098}00098\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (keyChainList.Any(x\ =>\ x.Serial\ ==\ header.\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_client_header_a19fd25dd10cc17b78cabec405636ff4e}{Serial}}))}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{throw}\ \textcolor{keyword}{new}\ ArgumentException(\textcolor{stringliteral}{"{}A\ keychain\ with\ this\ serial\ is\ already\ exists"{}});}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00102}00102\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00103}00103\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ ksFileName\ =\ Path.Combine(Path.GetDirectoryName(\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_a73b0251bf7f720e7a5ebce006bd54193}{FilePath}}),\ BitConverter.ToString(keyStore.\mbox{\hyperlink{struct_s_a_p_team_1_1_kryptor_1_1_key_store_a13eeddb6bcec7c0663c13ea9502a4472}{Fingerprint}}).Replace(\textcolor{stringliteral}{"{}-\/"{}},\ \textcolor{stringliteral}{"{}"{}}).ToLower()\ +\ \textcolor{stringliteral}{"{}.kks"{}});}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00105}00105\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (\textcolor{keywordtype}{string}.IsNullOrEmpty(transformerToken)\ \&\&\ !File.Exists(ksFileName))}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00106}00106\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00107}00107\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ File.WriteAllBytes(ksFileName,\ keyStore.\mbox{\hyperlink{struct_s_a_p_team_1_1_kryptor_1_1_key_store_a43d431b918a4fc357132e26cd457f526}{Raw}});}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00108}00108\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00109}00109\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00110}00110\ \ \ \ \ \ \ \ \ \ \ \ \ keyChainList.Add(\textcolor{keyword}{new}\ \mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain}{KeyChain}}()}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00111}00111\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00112}00112\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Serial\ =\ header.\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_client_header_a19fd25dd10cc17b78cabec405636ff4e}{Serial}},}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00113}00113\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ Fingerprint\ =\ keyStore.\mbox{\hyperlink{struct_s_a_p_team_1_1_kryptor_1_1_key_store_a13eeddb6bcec7c0663c13ea9502a4472}{Fingerprint}},}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00114}00114\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \mbox{\hyperlink{struct_s_a_p_team_1_1_kryptor_1_1_transformer_token}{TransformerToken}}\ =\ transformerToken}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00115}00115\ \ \ \ \ \ \ \ \ \ \ \ \ \});}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00116}00116\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00117}00117\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00121}\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_ae3fb56e9557825416b9a6719d084a27d}{00121}}\ \ \ \ \ \ \ \ \ \textcolor{keyword}{public}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_ae3fb56e9557825416b9a6719d084a27d}{Save}}()}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00122}00122\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00123}00123\ \ \ \ \ \ \ \ \ \ \ \ \ lock\ (\_saveLock)}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00124}00124\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00125}00125\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordtype}{string}\ kJson\ =\ Utilities.ClientTypesJsonWorker.ToJson(keyChainList);}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00126}00126\ }
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00127}00127\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ File.WriteAllText(\mbox{\hyperlink{class_s_a_p_team_1_1_kryptor_1_1_client_1_1_key_chain_collection_a73b0251bf7f720e7a5ebce006bd54193}{FilePath}},\ kJson);}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00128}00128\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00129}00129\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00130}00130\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{_key_chain_collection_8cs_source_l00131}00131\ \}}

\end{DoxyCode}
